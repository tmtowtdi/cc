
--inv bxF3p2yy

function find(item_name)
  local simp_name = simplify_name(item_name)
  for i = 1,16 do 
    data = turtle.getItemDetail(i)
    if data then
      if simplify_name(data.name) == simp_name then
        if simp_name ~= item_name then    -- user passed FQ name
          if data.name == item_name then
            return i      -- FQ item name matches arg
          else
            return false  -- Simple names match, but FQ names do not.
          end
        else
          return i        -- Arg is simple, matches.  Close enough.
        end
      end
    end
  end
  return false
end

function find_all(item_name)
  simp_name = simplify_name(item_name)
  local slots = {}
  for i = 1,16 do 
    data = turtle.getItemDetail(i)
    if data then
      if simplify_name(data.name) == simp_name then
        if simp_name ~= item_name then    -- user passed FQ name
          if data.name == item_name then
            table.insert(slots, i)        -- FQ name matches arg
          end
        else
          table.insert(slots, i)          -- Arg is simple, matches, close enough.
        end
      end
    end
  end
  return slots
end

function consolidate(item_name)
  local slots = find_all(item_name)
  for i = #slots, 1, -1 do
    turtle.select(slots[i])
    for j = 1, (i-1) do
      if not turtle.transferTo(slots[j]) then break end       -- could not xfer to previous slot (it may be full)
      if not turtle.getItemCount(slots[j]) then break end     -- No items left in selected slot; it's empty.
    end
  end
end

function consolidate_all()
    for i = 1,16 do
        local d = turtle.getItemDetail(i)
        consolidate(d.name)
    end
end

function all_slots_used()
    for i = 1,16 do
        if not turtle.getItemDetail(i) then return false end
    end
    return true
end

function simplify_name(item_name)
  local new = string.gsub(item_name, "%w+:", "")
  return new
end

function name_is_fq(item_name)
  item_name = item_name or ''
  if string.find(item_name,':') then return true else return false end
end

 -- vim: syntax=lua

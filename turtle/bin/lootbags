
--lootbags

--[[
  Search on CHECK


  Before doing any more work on this, I 
  really need to know if it's even 
  possible for a turtle to open our 
  lootbags.



  Check input for lootbag, process it 
  and dump its contents to output, 
  sleep for 5 seconds:
    > bin/lootbags

  Same, but only sleep for 2 seconds 
  after processing a bag:
    > bin/lootbags 2

--]]

os.loadAPI("lib/inv")
local args = {...}

---------------------------------------
-- EDIT

--[[
  PICK ONE.
  Where is the chest containing unprocessed lootbags relative to the turtle?
--]]
--local suck_from = turtle.suck
--local suck_from = turtle.suckUp
--local suck_from = turtle.suckDown

--[[
  PICK ONE.
  Where is the chest we're going to drop loot into relative to the turtle.
--]]
--local drop_to = turtle.drop
--local drop_to = turtle.dropUp
--local drop_to = turtle.dropDown


--[[
  Another option is to put the turtle 
  between input and output sources and 
  tell him which direction is which, 
  and just have him turn in the correct 
  direction depending on if he's 
  sucking or blowing (giggity).

  *****
  Another is to just give him coords of 
  the two inventories (call the input 
  "home" and the output "box") and let 
  him go_home, suck a bag, process the 
  bag, then return_to_box(), which will 
  dump his inv.  The movement will make 
  things slow, but we don't really need 
  top speed for this and I'm starting 
  to like this idea.
  *****
--]]

-- DONE EDITING
---------------------------------------

local sleeptime = args[1] or 5



if not suck_from or not drop_to then
  print("You must set 'suck_from' and 'drop_to'!")
  print("Edit this script to set the values.")
  return
end


--[[
  Returns true if 'name' is a lootbag, false otherwise.
--]]
function isa_lootbag(name)
  --[[
    CHECK
    'name' is the FQ name of an item.  I need to figure out what the FQ names 
    of the lootbags we encounter look like.

    And since there are different kind of lootbags, I need to take them all 
    into account.
  --]]
end


while true do
  print("Checking input source for lootbags...")
  turtle.select(1)
  if suck_from(1) then
    local data = turtle.getItemDetail(1)
    if isa_lootbag(data.name) then
      print("...found one.")
      --[[
        CHECK
        turtle.place() places an item from the selected slot (good) forward, 
        ahead of the turtle.
        I need to know if:
          - turtle.place() opens a lootbag and gets its contents
          - does turtle.place() work if there's a block in front of me?
            - If not, I'll have to use turtle.placeUp() or placeDown(),  
              whichever direction is free.
      --]]
      turtle.place()
      local sname = inv.simplify_name(data.name)
      print("I opened a "..sname..".")
    end

    for i = 1,16 do
      turtle.select(i)
      local cnt = turtle.getItemCount()
      if cnt > 0 then
        local data = turtle.getItemDetail()
        local sname = inv.simplify_name(data.name)
        print("Outputting "..cnt.." of "..sname".")
        drop_to()
      end
    end
  end

  sleep( sleeptime )
end



 -- vim: syntax=lua

